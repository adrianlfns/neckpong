<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Head-Controlled Pong</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="loader" class="d-flex justify-content-center align-items-center vh-100 position-absolute w-100 h-100" style="background-color: rgba(0,0,0,0.8); z-index: 1060;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="container-fluid vh-100 d-flex flex-column">
        <header class="text-center py-3">
            <h1 class="display-4">Head-Controlled Pong</h1>
            <p class="lead">Best Score: <span id="best-score">0</span></p>
        </header>

        <main class="row flex-grow-1">
            <div class="col-lg-8 col-md-12 order-md-2 order-lg-1 d-flex flex-column justify-content-center align-items-center position-relative game-container">
                <canvas id="pong-canvas"></canvas>
            </div>

            <div class="col-lg-4 col-md-12 order-md-1 order-lg-2 d-flex flex-column justify-content-center align-items-center bg-dark text-light p-4 control-panel">
                <h2 class="h4">Head Tracking</h2>
                <div class="position-relative w-100 mb-3" style="aspect-ratio: 4/3;">
                    <video id="webcam" class="w-100 h-100" playsinline autoplay muted></video>
                    <canvas id="overlay-canvas" class="position-absolute top-0 start-0 w-100 h-100"></canvas>
                </div>
                <div id="webcam-error" class="alert alert-danger d-none w-100 text-center">
                    Webcam not found. Please check permissions.
                    <button id="retry-camera-btn" class="btn btn-sm btn-light mt-2">Retry</button>
                </div>
                <div class="d-flex justify-content-around w-100 mb-3">
                    <span id="status-badge" class="badge bg-danger">Disconnected</span>
                    <span id="face-detected-badge" class="badge bg-secondary">No Face Detected</span>
                </div>
                <div class="text-center">
                    <h3 class="h5">Tilt Control</h3>
                    <div class="tilt-visualizer">
                        <span id="tilt-angle" class="h4">0.00°</span>
                        <div id="tilt-arrow-container">
                            <span id="tilt-arrow" class="tilt-arrow">⬆</span>
                        </div>
                    </div>
                </div>
                <div id="game-controls" class="mt-4">
                    <button id="pause-resume-btn" class="btn btn-primary">Pause</button>
                    <button id="settings-btn" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#settings-modal">Settings</button>
                    <button id="instructions-btn" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#instructions-modal">Instructions</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="instructions-modal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Instructions</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>Control your paddle by tilting your head left and right. The first player to score 5 points wins. Use the settings to adjust difficulty and sensitivity. You can calibrate your head tracking for better control.</p></div></div></div></div>
    <div class="modal fade" id="start-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Welcome!</h5></div><div class="modal-body"><p>Use your head to control the paddle.</p></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="start-game-btn">Start Game</button></div></div></div></div>
    <div class="modal fade" id="game-over-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Game Over</h5></div><div class="modal-body"><p id="final-score-text"></p></div><div class="modal-footer"><button type="button" class="btn btn-primary" id="restart-game-btn">Restart</button></div></div></div></div>
    <div class="modal fade" id="settings-modal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Settings</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-3"><label for="difficulty-select" class="form-label">Difficulty</label><select class="form-select" id="difficulty-select"><option value="easy">Easy</option><option value="medium" selected>Medium</option><option value="hard">Hard</option></select></div><div class="mb-3"><label for="sensitivity-slider" class="form-label">Sensitivity</label><input type="range" class="form-range" min="0.5" max="2.5" step="0.1" id="sensitivity-slider" value="1.5"></div><button class="btn btn-info" id="start-calibration-btn" data-bs-toggle="modal" data-bs-target="#calibration-modal">Start Calibration</button></div></div></div></div>
    <div class="modal fade" id="calibration-modal" data-bs-backdrop="static" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Calibration</h5></div><div class="modal-body"><p>Look directly at the camera to set the center point. Then, tilt your head left and right to see the paddle move.</p><div class="progress mt-3"><div id="calibration-progress" class="progress-bar" role="progressbar" style="width: 0%;"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-bs-dismiss="modal">Done</button></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="js/camera.js"></script>
    <script src="js/face-tracking.js"></script>
    <script src="js/main.js"></script>
    <script src="js/pong.js"></script>    
</body>
</html>
